<div class="chat-container">
  <!-- Group List -->
  <div class="group-list">
    <h2>Groups</h2>
    <div
      class="group"
      *ngFor="let group of groups"
      (click)="selectGroup(group)"
      [class.active]="currentGroup && currentGroup._id === group._id"
    >
      {{ group.name }}
    </div>
  </div>

  <!-- Channel List -->
  <div class="channel-list" *ngIf="currentGroup">
    <h3>Channels in {{ currentGroup.name }}</h3>
    <div
      class="channel"
      *ngFor="let channel of channels"
      (click)="joinChannel(channel)"
      [class.active]="currentChannel && currentChannel._id === channel._id"
    >
      {{ channel.name }}
    </div>

    <div class="leave-actions">
      <!-- Normal user leaves group -->
      <button *ngIf="userRole === 'user'" 
              (click)="leaveGroup(currentGroup._id)" 
              class="leave-group-btn">
        Leave Group
      </button>
    
      <!-- Admin leaves group -->
      <button *ngIf="userRole === 'admin'" 
              (click)="leaveGroupAdmin(currentGroup._id)" 
              class="leave-admin-btn">
        Leave Group (Admin)
      </button>
    </div>
  </div>

  <!-- Chat Box -->
  <div class="chat-box" *ngIf="currentChannel">
    <div class="messages">
      <div *ngFor="let message of messages" class="message">
        <strong>{{ message.username }}:</strong>
        {{ parseContent(message.content).content }}

        <!-- Image message -->
        <div *ngIf="parseContent(message.content).imageUrl">
          <img
            [src]="parseContent(message.content).imageUrl"
            alt="Uploaded image"
            class="message-image"
          />
        </div>

        <!-- Video message -->
        <div *ngIf="parseContent(message.content).videoUrl">
          <video
            [src]="parseContent(message.content).videoUrl"
            controls
            class="message-video"
          ></video>
        </div>
      </div>
    </div>

    <!-- Input Box -->
    <div class="message-input" *ngIf="isInChannel">
      <input [(ngModel)]="message" placeholder="Type a message" />
      <button (click)="sendMessage()" class="send-button">Send</button>

      <!-- Upload Image -->
      <div class="upload-buttons">
        <label for="imageInput" class="upload-button">
          <i class="fa fa-image"></i>
          <span>Upload Image</span>
        </label>
        <input
          type="file"
          id="imageInput"
          accept="image/*"
          (change)="onImageSelect($event)"
          hidden
        />
      </div>

      <!-- Video chat buttons -->
      <button
        *ngIf="!isInVideoChat"
        (click)="startVideoChat()"
        class="join-video-btn"
      >
        Join Video Chat
      </button>
      <button
        *ngIf="isInVideoChat"
        (click)="leaveVideoChat()"
        class="leave-video-btn"
      >
        Leave Video Chat
      </button>
    </div>
  </div>

  <!-- Video Chat Window -->
  <div class="video-chat" *ngIf="isInVideoChat">
    <!-- Remote video area -->
    <div class="remote-video-container"></div>

    <!-- Local small window -->
    <div class="local-video-container">
      <span class="video-label">You</span>
      <video id="localVideo" autoplay muted></video>
    </div>
  </div>

  <!-- Admin Button -->
  <div *ngIf="isAdminOrSuperAdmin()">
    <button (click)="navigateToAdminPage()" class="go-to-admin-btn">
      Go to Admin Page
    </button>
  </div>
</div>
